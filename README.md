# Infrastructure Monitoring Application

A Rails-based application for configuring and managing Telegraf monitoring agents to collect metrics from various sources and store them in InfluxDB.

## Features

- Configure CPU, Memory, and Docker container monitoring
- Support for both local and remote host monitoring
- Dynamic configuration generation for Telegraf
- User-friendly admin interface for managing monitoring configurations
- Real-time metrics collection and storage

## System Requirements

- Ruby 3.2.0+
- Rails 7.2+
- Docker and Docker Compose
- InfluxDB 2.7+
- Telegraf 1.28+

## Getting Started

### Setup

1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd infr-monitoring
   ```

2. Install dependencies:
   ```bash
   bundle install
   ```

3. Set up the database:
   ```bash
   rails db:create db:migrate db:seed
   ```

4. Start the application with Docker Compose:
   ```bash
   docker-compose up
   ```

5. Access the application at http://localhost:3005

### Configuration

The application uses Docker Compose to set up the following services:
- Rails web application
- InfluxDB time-series database
- Telegraf monitoring agent

Default credentials for the admin interface:
- Email: admin@example.com
- Password: password

## Monitoring Configuration

### CPU Monitoring

Configure CPU monitoring with the following options:
- Interval: How often to collect metrics (e.g., 10s, 1m, 1h)
- Per CPU: Collect metrics for each CPU core
- Total CPU: Collect aggregate CPU metrics
- Remote hosts: Monitor CPU on remote servers

### Memory Monitoring

Configure memory monitoring with the following options:
- Interval: How often to collect metrics
- Swap memory: Include swap memory metrics
- Platform memory: Include platform-specific memory metrics
- Remote hosts: Monitor memory on remote servers

## Remote Host Monitoring

The application supports monitoring remote hosts using:
1. SSH-based monitoring (requires SSH key setup)
2. HTTP-based monitoring (requires Telegraf agents on remote hosts)

To configure remote monitoring:
1. Add comma-separated list of remote hosts
2. Enable SSH if using SSH-based monitoring
3. Provide SSH username for authentication

## Architecture

- **Rails Application**: Provides the admin interface and configuration management
- **InfluxDB**: Stores all collected metrics
- **Telegraf**: Collects metrics based on configurations generated by the Rails app

## Development

### Directory Structure

- `app/models/telegraf_*_config.rb`: Models for different monitoring configurations
- `app/admin/`: ActiveAdmin resources for the admin interface
- `app/services/telegraf_config_generator.rb`: Service for generating Telegraf configs
- `config/telegraf/`: Directory for Telegraf configuration files

### Adding New Monitoring Types

1. Create a new model with the appropriate fields
2. Implement the config generation method
3. Create an ActiveAdmin resource for the new monitoring type

## Troubleshooting

- **Docker Socket Permission Issues**: The Telegraf container runs with privileged mode to access the Docker socket
- **Missing Configuration Files**: Check that the config directory exists and has proper permissions
- **Remote Host Connection Issues**: Verify SSH keys are properly set up for remote monitoring

## License

This project is licensed under the MIT License - see the LICENSE file for details.
